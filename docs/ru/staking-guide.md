# Гид по стейкингу

## Обзор

Стейкинг в ComputeChain позволяет:
- **Стать валидатором** - производить блоки, получать награды
- **Делегировать валидаторам** - получать пассивный доход
- **Участвовать в консенсусе** - обеспечивать безопасность сети

## Стейкинг (Стать валидатором)

### Требования

- **Минимальный стейк:**
  - Devnet: 1,000 CPC
  - Mainnet: 100,000 CPC
- **Нода:** Необходимо запускать ноду валидатора
- **Uptime:** Минимум 75% для сохранения активности

### Застейкать токены

```bash
./cpc-cli tx stake <СУММА> --from <ИМЯ_КЛЮЧА>
```

**Пример:**

```bash
# Застейкать 500 CPC
./cpc-cli tx stake 500 --from mykey
```

**Что происходит:**
1. Токены блокируются с вашего баланса
2. Создается валидатор с адресом `cpcvalcons1...`
3. Активируется в следующую эпоху (через 100 блоков)

### Вывести стейк

```bash
./cpc-cli tx unstake <СУММА> --from <ИМЯ_КЛЮЧА>
```

**Важно:**
- Можно вывести частично или полностью
- **Период разблокировки:**
  - Devnet: 100 блоков (~16 минут)
  - Mainnet: 21 день
- **Штраф при jailing:** 10% сжигается при выводе в состоянии jailed
- Полный вывод → валидатор деактивируется
- Токены автоматически возвращаются после периода разблокировки

## Делегирование

### Делегировать валидатору

Получайте пассивные награды, делегируя валидаторам.

**Лимиты:**
- **Минимальное делегирование:** 100 CPC
- **Макс. валидаторов на делегатора:** 10
- **Макс. мощность валидатора:** 20% от общей voting power

```bash
./cpc-cli tx delegate <АДРЕС_ВАЛИДАТОРА> <СУММА> --from <ИМЯ_КЛЮЧА>
```

**Пример:**

```bash
# Делегировать 100 CPC валидатору
./cpc-cli tx delegate cpcvalcons1abc... 100 --from mykey
```

### Проверить делегации

```bash
./cpc-cli query delegations <ВАШ_АДРЕС>
```

**Вывод:**

```
Delegator: cpc1abc...
Total Delegated: 100.0 CPC

Validator                Amount    Commission  Name
------------------------------------------------------
cpcvalcons1xyz...        60.0      10.0%       Validator A
cpcvalcons1def...        40.0      5.0%        Validator B
```

### Отменить делегирование

```bash
./cpc-cli tx undelegate <АДРЕС_ВАЛИДАТОРА> <СУММА> --from <ИМЯ_КЛЮЧА>
```

**Важно:**
- **Период разблокировки:** Такой же как у валидаторов (21 день mainnet / 100 блоков devnet)
- **Без штрафа:** Делегаторы не штрафуются за отзыв делегирования
- **Риск слешинга:** Если валидатор заслешен, делегаторы тоже теряют 5%
- Токены автоматически возвращаются после периода разблокировки

## Награды

### Как работают награды

**Награда за блок:** 10 CPC за блок (уменьшается вдвое каждые 1М блоков)

**Распределение награды за блок:**
- **70%** → Пул валидаторов (производитель блока)
- **30%** → Пул майнеров (PoC воркеры, пока сжигается до Фазы 2A)

**Распределение комиссий за транзакции:**
- **90%** → Валидатор (производитель блока)
- **10%** → Казначейство (community pool)

**Распределение наград валидатора:**
1. **У валидатора есть делегации:**
   - Валидатор получает комиссию (0-20%, настраивается)
   - Делегаторы делят оставшуюся сумму пропорционально
   - Любая пыль от целочисленного деления сжигается

2. **Нет делегаций:**
   - Валидатор получает 100% своего пула

**Пример:**

```
Награда за блок: 10 CPC
Пул валидатора (70%): 7 CPC
Комиссия валидатора: 10%
Всего делегировано: 100 CPC

→ Валидатор: 0.7 CPC (комиссия)
→ Делегатор A (60 CPC): 3.78 CPC
→ Делегатор B (40 CPC): 2.52 CPC
```

### Проверить награды

```bash
./cpc-cli query rewards <ВАШ_АДРЕС>
```

**Вывод:**

```
Delegator: cpc1abc...
Total Rewards: 125.5 CPC

Epoch    Reward
------------------
0        25.4 CPC
1        24.8 CPC
2        25.1 CPC
```

### Получение наград

Награды **автоматически зачисляются** на ваш баланс - ручное получение не требуется!

## Комиссия

### Для валидаторов

Установите свою ставку комиссии (0-20%):

```bash
./cpc-cli tx update-validator --commission 0.15 --from mykey
```

**Правила:**
- **Диапазон:** 0% - 20% максимум
- **Время ожидания:** 7 дней между изменениями
- **Период объявления:** 4 часа до вступления в силу
- **Макс. увеличение:** +5 процентных пунктов за изменение

**Пример:**
```
День 0: Комиссия 5%
День 7: Объявление изменения до 10% → Вступает в силу через 4 часа
День 14: Можно изменить снова (время ожидания прошло)
```

**По умолчанию:** 10%
**Рекомендуется:** 5-15%

### Для делегаторов

Выбирайте валидаторов с:
- ✅ Низкой комиссией (больше наград для вас)
- ✅ Высоким uptime (стабильные награды)
- ✅ Хорошей репутацией

**Защита:** Во время 4-часового периода объявления делегаторы могут отозвать делегирование без штрафа (только обычный период разблокировки 21 день).

## Советы

**Для валидаторов:**
- Поддерживайте uptime >75% для избежания jailing
- Установите разумную комиссию (5-15%)
- Обновите метаданные (имя, сайт) для видимости

**Для делегаторов:**
- Диверсифицируйте между несколькими валидаторами
- Проверяйте uptime и комиссию валидатора
- Регулярно отслеживайте награды

## Следующие шаги

- **[Экономика](economics.md)** - Полная экономическая модель, токеномика и распределение наград
- **[Гид валидатора](validator-guide.md)** - Запуск ноды валидатора, управление жизненным циклом
- **[Справочник CLI](cli-reference.md)** - Полный список команд
- **[Справочник API](api-reference.md)** - Запросы через RPC
